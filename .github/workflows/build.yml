  name: Build and release CLI executable

  on: [push]

  jobs:
    build:
      runs-on: ubuntu-latest

      steps:
        - uses: actions/checkout@v4
        - name: Set up Python
          # This is the version of the action for setting up Python, not the Python version.
          uses: actions/setup-python@v5
          with:
            # Semantic version range syntax or exact version of a Python version
            python-version: "3.12"
            # Optional - x64 or x86 architecture, defaults to x64
            architecture: "x64"
        # You can test your matrix by printing the current Python version
        - name: Display Python version
          run: python -c "import sys; print(sys.version)"
        # Setup gh cli
        - name: Set up GitHub CLI
          run: |
            sudo apt update
            sudo apt install -y gh
        # python deps
        - name: Installing dependencies
          run: |
            python -m pip install --upgrade pip
            pip install -r requirements.txt

        - name: Building binaries
          run: |
            python PhraseCraft/build_phrasec.py

        - name: Authenticate gh
          run: echo "${{ secrets.PAT_TOKEN }}" | gh auth login --with-token

        - name: Create a Release
          run: |
            RELEASE_TAG=$(echo $GITHUB_REF | sed 's/refs\/tags\///')
            gh release create "linux-ci" ./dist/* \
              --title "Release linux-ci" \
              --notes "Automated release for linux-ci"

        - name: Verify Release
          run: gh release view "linux-ci"
